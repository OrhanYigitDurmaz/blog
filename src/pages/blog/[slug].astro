---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
    const posts = await getCollection("blog");
    return posts.map((post) => ({
        params: { slug: post.slug },
        props: { post },
    }));
}

// 2. Get the post from props
interface Props {
    post: CollectionEntry<"blog">;
}
const { post } = Astro.props;

// 3. Render the Markdown content
const { Content } = await post.render();

// Helper to format date
const formatDate = (date: Date) => {
    return date.toISOString().split("T")[0];
};
---

<MainLayout title={post.data.title}>
    <div class="max-w-3xl mx-auto">
        <div class="mb-8 border-b border-dashed border-gray-700 pb-8">
            <a
                href="/blog"
                class="text-sm text-gray-500 hover:text-primary mb-4 inline-block transition-colors"
            >
                &lt; cd ..
            </a>

            <div class="font-mono text-sm text-gray-500 mb-2">
                <span class="text-green-500">âžœ</span>
                <span class="text-blue-500">~</span>
                <span class="text-gray-400">/articles/</span>
                <span class="text-white">{post.slug}.md</span>
            </div>

            <h1 class="text-3xl md:text-4xl font-bold text-gray-100 mb-4 mt-2">
                {post.data.title}
            </h1>

            <div class="flex flex-wrap gap-4 text-sm font-mono text-gray-400">
                <span class="flex items-center gap-1">
                    <span class="material-icons text-sm">person</span>
                    {post.data.author}
                </span>
                <span class="flex items-center gap-1">
                    <span class="material-icons text-sm">schedule</span>
                    {formatDate(post.data.pubDate)}
                </span>
                <span class="flex items-center gap-1">
                    <span class="material-icons text-sm">folder</span>
                    {post.data.tags.join(", ")}
                </span>
            </div>
        </div>

        <article
            class="prose prose-invert prose-lg max-w-none
      prose-headings:font-bold prose-headings:text-gray-100
      prose-a:text-primary prose-a:no-underline hover:prose-a:underline
      prose-pre:bg-gray-900 prose-pre:border prose-pre:border-gray-800
      prose-code:text-primary prose-code:font-mono prose-code:before:content-none prose-code:after:content-none"
        >
            <Content />
        </article>

        <div class="mt-12 pt-8 border-t border-dashed border-gray-700">
            <p class="font-mono text-sm text-gray-500 text-center">
                // End of file. <a
                    href="/blog"
                    class="text-primary hover:underline">Return to logs</a
                >
            </p>
        </div>
    </div>
</MainLayout>
